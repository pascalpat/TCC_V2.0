<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Gestion de projet — TCC App{% endblock %}</title>

  <!-- Base styles for header, footer, and general layout -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  {% block extra_css %}{% endblock %}
</head>

<body>
  <!-- ——————————————————————————————————————————————————————
       0) Global API endpoints (no more hard-coded URLs)
  —————————————————————————————————————————————————————— -->
  <script>
    window.API = {
      // Notes & Speech recognition
      getSpeechConfig:      "{{ url_for('dailynotes.get_speech_config') }}",
      listNotes:            "{{ url_for('dailynotes.list_notes') }}",
      addNote:              "{{ url_for('dailynotes.add_note') }}",
      commitNotes:          "{{ url_for('dailynotes.commit_notes') }}",
      deleteNoteBase:       "{{ url_for('dailynotes.delete_note', note_id=0) }}",

      // Weather
      getWeather:           "{{ url_for('main_bp.weather') }}",

      // Day initialization & data-entry
      initializeDay:        "{{ url_for('data_entry_bp.initialize_day') }}",
      getDayStatus:         "{{ url_for('data_entry_bp.get_days_status') }}",
      submitDataEntry:      "{{ url_for('data_entry_bp.submit_data_entry') }}",

      // Progress tracking
      updateProgress:       "{{ url_for('update_progress.update_progress') }}",
      getProgress:          "{{ url_for('update_progress.get_progress') }}",

      // Dropdowns & lists
      listWorkersAndEquipment: "{{ url_for('workers_bp.get_workers_list') }}",
      listActivityCodes:       "{{ url_for('activity_codes.get_activity_codes') }}",
      listPaymentItems:        "{{ url_for('data_entry_bp.list_payment_items') }}",
      listCwPackages:          "{{ url_for('labor_equipment_bp.list_cw_packages') }}",

      // Materials
      confirmMaterials:       "{{ url_for('materials_bp.confirm_materials') }}",
      getPendingMaterials:    "{{ url_for('materials_bp.get_pending_materials') }}",
      updateMaterialBase:     "{{ url_for('materials_bp.update_material_entry', entry_id=0) }}",
      deleteMaterialBase:     "{{ url_for('materials_bp.delete_material_entry', entry_id=0) }}",

      // Calendar
      calendarPage:     "{{ url_for('calendar_bp.calendar_page') }}",
      getCalendarData:  "{{ url_for('calendar_bp.get_calendar_data') }}"
    };
  </script>

  <!-- Module scripts -->
  <script type="module">
    import { getCurrentDate, highlightDates, getTemperature, restoreProgress }
      from "{{ url_for('static', filename='js/date_temp_loader.js') }}";

    document.addEventListener('DOMContentLoaded', () => {
      getCurrentDate();
      highlightDates();
      getTemperature();
      restoreProgress();
    });
  </script>

  <!-- Header Section -->
  <header>
    <div class="header-container">
      <div class="left-info">
        <img src="{{ url_for('static', filename='Projestim.png') }}" alt="Logo" class="logo">
        <span id="todayDate" class="today-label"></span>
        <div class="weather-widget">
          <img id="weatherIcon" src="" alt="Weather Icon">
          <span id="currentTemperature">--°C</span>
        </div>
      </div>
      <div class="center-info">
        <h1>Gestion de projet — Module Rapport Journalier</h1>
      </div>
      <div class="right-info">
        <p class="greeting">Bonjour, {{ username or user_id }} !</p>
        <a href="{{ url_for('auth_bp.logout') }}" id="logoutButton">Log Out</a>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main>
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 MyCompany — Tous droits réservés.</p>
  </footer>

  <!-- Additional Scripts -->
  {% block extra_js %}{% endblock %}
</body>
</html>
